<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRIS Admin - Job Listings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic Styling (can move to style.css later) */
        body { font-family: sans-serif; background-color: #f8f9fa; }
        #admin-login-view { max-width: 500px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .list-group-item { display: flex; justify-content: space-between; align-items: center; }
        .list-group-item .actions button { margin-left: 5px; }
        #logoPreview { border: 1px solid #ddd; max-height: 60px; display: none; margin-top: 10px; }
        .modal-body { max-height: 75vh; overflow-y: auto; }
        .custom-field-row { display: flex; align-items: center; }
        .custom-field-row .col-5 { padding-right: 5px; }
        .custom-field-row .col-2 { text-align: right; }
        .loading-spinner { /* Basic spinner styling */
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%;
            width: 30px; height: 30px; animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="admin-login-view" class="container mt-5">
        <h2 class="text-center mb-4">IRIS Admin Login</h2>
        <form id="admin-login-form">
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
            <p id="admin-login-error" class="text-danger mt-3 text-center"></p>
        </form>
    </div>

    <div id="admin-dashboard-view" style="display: none;" class="container-fluid mt-3 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3 p-3 bg-dark text-white rounded">
            <h2><i class="fas fa-briefcase me-2"></i> Job Listings Management</h2>
            <div>
                <span id="admin-user-info" class="me-3"></span>
                <button id="admin-sign-out-button" class="btn btn-danger btn-sm"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
            </div>
        </div>

        <div class="container">
            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#jobModal" id="addJobBtn">
                <i class="fas fa-plus me-1"></i> Add New Job Posting
            </button>

            <h4>Existing Job Postings:</h4>
            <div id="jobListingsContainerAdmin" class="list-group shadow-sm">
                <div class="text-center p-5">
                    <div class="loading-spinner"></div>
                    <p>Loading jobs...</p>
                </div>
                </div>
        </div>
    </div>

    <div class="modal fade" id="jobModal" tabindex="-1" aria-labelledby="jobModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl"> <div class="modal-content">
                <form id="jobForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="jobModalLabel">Add/Edit Job</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="jobId"> <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="title" class="form-label">Job Title*</label>
                                <input type="text" class="form-control" id="title" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="companyName" class="form-label">Company Name*</label>
                                <input type="text" class="form-control" id="companyName" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="companyLogo" class="form-label">Company Logo</label>
                                <input type="file" class="form-control" id="companyLogo" accept="image/png, image/jpeg, image/gif, image/webp">
                                <img id="logoPreview" src="#" alt="Logo Preview"/>
                                <input type="hidden" id="companyLogoUrl"> </div>
                            <div class="col-md-6 mb-3">
                                <label for="location" class="form-label">Location*</label>
                                <input type="text" class="form-control" id="location" placeholder="e.g., Remote, Chennai, India" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Category*</label>
                                <input type="text" class="form-control" id="category" placeholder="e.g., Technology" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="subCategory" class="form-label">Sub-Category*</label>
                                <input type="text" class="form-control" id="subCategory" placeholder="e.g., Backend Development" required>
                            </div>
                        </div>
                         <div class="mb-3">
                            <label for="description" class="form-label">Job Description*</label>
                            <textarea class="form-control" id="description" rows="5" placeholder="Enter full job description (HTML can be used for formatting)" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="requirements" class="form-label">Requirements*</label>
                            <textarea class="form-control" id="requirements" rows="4" placeholder="Enter key requirements and qualifications (HTML can be used)" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="experienceLevel" class="form-label">Experience Level*</label>
                                <input type="text" class="form-control" id="experienceLevel" placeholder="e.g., 3-5 years, Entry Level" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="techStacks" class="form-label">Tech Stacks (comma-separated)*</label>
                                <input type="text" class="form-control" id="techStacks" placeholder="e.g., Python, React, Node.js, AWS" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="previousInterviewQuestions" class="form-label">Previous Interview Questions</label>
                            <div class="small text-muted mb-2">Enter one question per line or separate with commas</div>
                            <textarea class="form-control" id="previousInterviewQuestions" rows="3" placeholder="Optional: Known questions asked previously (e.g. 'Explain dependency injection', 'Describe your experience with agile methodologies')"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="sourceLink" class="form-label">Source Link</label>
                                <input type="url" class="form-control" id="sourceLink" placeholder="Optional: Link to original job posting">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="salaryRange" class="form-label">Salary Range</label>
                                <input type="text" class="form-control" id="salaryRange" placeholder="Optional: e.g., ₹12L - ₹18L PA">
                            </div>
                        </div>
                        <div class="row align-items-end">
                            <div class="col-md-4 mb-3">
                                <label for="postedDate" class="form-label">Posted Date*</label>
                                <input type="date" class="form-control" id="postedDate" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="expiryDate" class="form-label">Expiry Date</label>
                                <input type="date" class="form-control" id="expiryDate">
                                <div class="form-text" id="expiryDateHelp"></div>
                            </div>
                            <div class="col-md-4 mb-3">
                                 <label for="status" class="form-label">Status*</label>
                                 <select class="form-select" id="status" required>
                                     <option value="active" selected>Active</option>
                                     <option value="inactive">Inactive</option>
                                     <option value="expired">Expired</option>
                                 </select>
                            </div>
                        </div>
                         <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="" id="relocation">
                            <label class="form-check-label" for="relocation">
                                Relocation Offered
                            </label>
                        </div>

                        <hr>
                        <h5>Custom Fields <small class="text-muted">(Optional)</small></h5>
                        <div id="customFieldsContainer" class="mb-2">
                            </div>
                        <button type="button" class="btn btn-outline-secondary btn-sm mb-3" id="addCustomFieldBtn">
                           <i class="fas fa-plus"></i> Add Custom Field
                        </button>
                        <hr>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" id="saveJobBtn">Save Job</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="auth-admin.js"></script>
    <script type="module" src="app-admin.js"></script>

</body>
</html>